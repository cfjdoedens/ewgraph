<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Equal width representation of chance graphs • ewgraph</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Equal width representation of chance graphs">
<meta name="description" content="Chance graphs are represented as tibbles, based on an even spaced base line on (0, 1).">
<meta property="og:description" content="Chance graphs are represented as tibbles, based on an even spaced base line on (0, 1).">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">ewgraph</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cfjdoedens/ewgraph/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ewgraph">ewgraph<a class="anchor" aria-label="anchor" href="#ewgraph"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of ewgraph is to represent and manipulate chance graphs as a finite grid of data elements. The individual elements are called segments. The grid is formed as a tibble. Each segment is a row of the tibble.</p>
<p>The package design is not based on information hiding: the idea is that users can know the details of how the chance graph is represented. And possibly use this knowledge in unforeseen ways.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of ewgraph from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"devtools"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"cfjdoedens/ewgraph"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This is a basic example which shows you how to solve a common problem:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cfjdoedens/ewgraph" class="external-link">ewgraph</a></span><span class="op">)</span></span>
<span><span class="co"># Construct an ewgraph of 1000 segments, resulting from a binomial draw of 300 samples,</span></span>
<span><span class="co"># with ten errors found.</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ew_from_vec.html">ew_from_vec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>, size <span class="op">=</span> <span class="fl">300</span>, <span class="fu"><a href="reference/partition_0_1.html">partition_0_1</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get most probable value for the error fraction, p, and accompanying </span></span>
<span><span class="co"># probability density, h.</span></span>
<span><span class="va">most_prob_ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ew_maxh.html">ew_maxh</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">most_prob_ph</span><span class="op">)</span></span>
<span><span class="co">#&gt;        h        p </span></span>
<span><span class="co">#&gt; 38.29659  0.03350</span></span>
<span></span>
<span><span class="co"># Get maximum value for the error fraction, p, given</span></span>
<span><span class="co"># certainty level cert.</span></span>
<span><span class="va">max_error_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ew_maxcumh_p.html">ew_maxcumh_p</a></span><span class="op">(</span><span class="va">g</span>, <span class="fl">.95</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">max_error_rate</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.05571198</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="equal-width-probability-graphs">equal width probability graphs<a class="anchor" aria-label="anchor" href="#equal-width-probability-graphs"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>An equal width probability graph, ewgraph, is a finite numeric representation of a function c from domain P to codomain H. <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>:</mo><mi>P</mi><mo>→</mo><mi>H</mi></mrow><annotation encoding="application/x-tex">c: P \rightarrow H</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> are the real numbers in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0, 1]</annotation></semantics></math>. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math> are the real numbers in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mi>i</mi><mi>n</mi><mi>f</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0,inf]</annotation></semantics></math>. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math> is interpreted in this context as a function that maps from an error fraction <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> to the chance density of that error fraction. <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h = c(p)</annotation></semantics></math> So <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math> is an absolutely continuous probability distribution. And <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math> is a probability density function.</p>
<p>This function, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>, is represented in an ewgraph as a finite set of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math> pairs <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo>,</mo><msub><mi>h</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(p_i, h_i)</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>:</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">1:S</annotation></semantics></math>. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math> a positive integer. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>i</mi></msub><annotation encoding="application/x-tex">p_i</annotation></semantics></math> are elements of P, so of [0, 1]. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>i</mi></msub><annotation encoding="application/x-tex">h_i</annotation></semantics></math> are elements of H, so of [0, inf]. <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub><mo>=</mo><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_i = c(p_i)</annotation></semantics></math></p>
<p>Let <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>=</mo><mn>1</mn><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>*</mo><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">U = 1 / (2 * S)</annotation></semantics></math> We define the ith segment of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> as <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mi>/</mi><mi>S</mi><mo>−</mo><mn>1</mn><mi>/</mi><mi>S</mi><mo>,</mo><mi>i</mi><mi>/</mi><mi>S</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[i / S - 1 / S, i / S]</annotation></semantics></math>. So all segments have equal width, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mi>S</mi><mo>=</mo><mn>2</mn><mo>*</mo><mi>U</mi></mrow><annotation encoding="application/x-tex">1 / S = 2 * U</annotation></semantics></math>. And there are <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math> segments. The middle of the ith segment being <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mi>i</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>−</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p_i = i /(S - U)</annotation></semantics></math> So the segments are: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mi>/</mi><mi>S</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mi>/</mi><mi>S</mi><mo>,</mo><mn>2</mn><mi>/</mi><mi>S</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>S</mi><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">[0, 1/S], [1/S, 2/S], ..., [(S - 1)/S, 1]</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="the-surface-of-a-segment">The surface of a segment<a class="anchor" aria-label="anchor" href="#the-surface-of-a-segment"></a>
</h3>
<p>An important aspect of a segment is its surface. For a probability density function, the probability that an outcome lies on a certain segment of P is proportional to the surface of that segment. We approximate the surface of the probability function as the surfaces of the segments of the corresponding equal width probability graph. The sum of the surfaces of all segments is by definition 1.</p>
<p>As a first approximation we can equal the surface of a segment to <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mi>/</mi><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_i * (1/S)</annotation></semantics></math>. See drawing below of segment i</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#                  |hi</span></span>
<span><span class="co">#                  |</span></span>
<span><span class="co">#                  |</span></span>
<span><span class="co">#                  |</span></span>
<span><span class="co">#                  |</span></span>
<span><span class="co">#   _______________|________________</span></span>
<span><span class="co">#   pi - U         pi               pi + U</span></span>
<span><span class="co">#   =              =                =</span></span>
<span><span class="co">#   i/S - 2U       i/S - U          i/S</span></span></code></pre></div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><msub><mi>e</mi><mi>i</mi></msub><mo>=</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mi>.</mi><mi>o</mi><mi>f</mi><mi>.</mi><mi>s</mi><mi>e</mi><mi>g</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>*</mo><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>.</mi><mi>o</mi><mi>f</mi><mi>.</mi><mi>s</mi><mi>e</mi><mi>g</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">surface_i = length.of.segment * height.of.segment</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo>+</mo><mi>U</mi><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo>−</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">)</mo><mo>*</mo><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">          = (p_i + U - (p_i - U))) * h_i</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>2</mn><mi>U</mi><mo>*</mo><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">= 2U * h_i</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mi>/</mi><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">= (1/S) * h_i</annotation></semantics></math></p>
<p>When the probability graph is rather flat this is a nice approximation. However on steep parts of the graph, the approximation is less a good fit. To improve on this we approximate the surface of a segment by computing also the height of the begin and end points of the segment. So by computing <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><msub><mi>p</mi><mrow><mi>i</mi><mo>−</mo><mi>U</mi></mrow></msub></msub><mo>≡</mo><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_{p_{i-U}} \equiv hleft_i</annotation></semantics></math>, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><msub><mi>p</mi><mrow><mi>i</mi><mo>+</mo><mi>U</mi></mrow></msub></msub><mo>≡</mo><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_{p_{i+U}} \equiv hright_i</annotation></semantics></math>. We can then compute the surface of segment <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> as the sum of its left and right parts.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#                  |hi</span></span>
<span><span class="co">#                  |</span></span>
<span><span class="co">#                  |               |hrighti</span></span>
<span><span class="co">#  |hlefti         |               |</span></span>
<span><span class="co">#  |               |               |</span></span>
<span><span class="co">#  |_______________|_______________|</span></span>
<span><span class="co">#  pi - U          pi              pi + U</span></span>
<span><span class="co">#   =              =                 =</span></span>
<span><span class="co"># i/S - 2U        i/S - U            i/S</span></span></code></pre></div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><msub><mi>e</mi><mi>i</mi></msub><mo>=</mo><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>.</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub><mo>+</mo><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>.</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">surface_i = surface.left_i + surface.right_i</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>.</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub><mo>=</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mi>.</mi><mi>o</mi><mi>f</mi><mi>.</mi><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi>.</mi><mi>h</mi><mi>a</mi><mi>l</mi><mi>v</mi><mi>e</mi><mi>.</mi><mi>o</mi><mi>f</mi><mi>.</mi><mi>s</mi><mi>e</mi><mi>g</mi><mi>m</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mi>i</mi></msub><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub><mo>+</mo><msub><mi>h</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">surface.left_i  = length.of.left.halve.of.segment_i *
                   (hleft_i + h_i) / 2</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mi>U</mi><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub><mo>+</mo><msub><mi>h</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">= U*(hleft_i + h_i) / 2</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>.</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub><mo>=</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mi>.</mi><mi>o</mi><mi>f</mi><mi>.</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>.</mi><mi>h</mi><mi>a</mi><mi>l</mi><mi>v</mi><mi>e</mi><mi>.</mi><mi>o</mi><mi>f</mi><mi>.</mi><mi>s</mi><mi>e</mi><mi>g</mi><mi>m</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mi>i</mi></msub><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">surface.right_i = length.of.right.halve.of.segment_i *
                  (h_i + hright_i) / 2</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mi>U</mi><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">= U*(h_i + hright_i) / 2</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><msub><mi>e</mi><mi>i</mi></msub><mo>=</mo><mi>U</mi><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub><mo>+</mo><msub><mi>h</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo>+</mo><mi>U</mi><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">surface_i = U*(hleft_i + h_i) / 2 + U*(h_i + hright_i) / 2</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub><mo>+</mo><mn>2</mn><mo>*</mo><msub><mi>h</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><mi>U</mi><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">= (hleft_i + hright_i + 2 * h_i) * U / 2</annotation></semantics></math></p>
<p>We compute <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">hleft_i</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">hright_i</annotation></semantics></math> by interpolation.</p>
<p>For <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">hleft_i</annotation></semantics></math> we proceed: Let <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>i</mi><mi>m</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mrow><mi>i</mi><mi>m</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_{im1} = c(p_{im1})</annotation></semantics></math> where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>m</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">im1</annotation></semantics></math> stands for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i - 1</annotation></semantics></math>. We then interpolate: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mi>i</mi></msub><mo>+</mo><msub><mi>h</mi><mrow><mi>i</mi><mi>m</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">hleft_i  = (h_i + h_{im1}) / 2</annotation></semantics></math></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#                                                  |hi</span></span>
<span><span class="co">#                                  |hlefti         |</span></span>
<span><span class="co">#                  |him1           |               |</span></span>
<span><span class="co">#                  |               |               |</span></span>
<span><span class="co">#   _______________|_______________|_______________|_______________</span></span>
<span><span class="co">#                  pim1            pi - U          pi</span></span>
<span><span class="co">#  segment i-1                     segment i</span></span></code></pre></div>
<p>In the same vein we get <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mi>i</mi></msub><mo>+</mo><msub><mi>h</mi><mrow><mi>i</mi><mi>p</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">hright_i = (h_i + h_{ip1}) / 2</annotation></semantics></math></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#                  |hi</span></span>
<span><span class="co">#                  |               |hrighti</span></span>
<span><span class="co">#                  | hi            |               |hip1</span></span>
<span><span class="co">#                  |               |               |</span></span>
<span><span class="co">#   _______________|_______________|_______________|_______________</span></span>
<span><span class="co">#                  pi              pim1 - U        pi</span></span>
<span><span class="co">#  segment i                       segment i+1</span></span></code></pre></div>
<p>This leaves us with the problem how to interpolate the leftmost <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">hleft_i</annotation></semantics></math>, so <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">hleft_1</annotation></semantics></math>, and the rightmost <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">hright_i</annotation></semantics></math>, so <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>S</mi></msub></mrow><annotation encoding="application/x-tex">hright_S</annotation></semantics></math>. This because, we can not interpolate with h_i from segment 0 or from segment <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">S+1</annotation></semantics></math>, as these segments do not exist. For those cases instead of interpolating we extrapolate.</p>
<p>For <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">hleft_1</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#                                                 |h2</span></span>
<span><span class="co">#                                 |               |</span></span>
<span><span class="co">#                 |h1             |               |</span></span>
<span><span class="co">#   |hleft1       |               |               |</span></span>
<span><span class="co">#   |_____________|_______________|_______________|_______________</span></span>
<span><span class="co">#   0             p1              p2 - U          p2</span></span>
<span><span class="co">#   segment 1                     segment 2</span></span></code></pre></div>
<p>The line through the coordinates <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>U</mi><mo>,</mo><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(U, h_1)</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>*</mo><mi>U</mi><mo>,</mo><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(3 * U, h_2)</annotation></semantics></math> has the algebraic form <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">y = ax+b</annotation></semantics></math>. So <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub><mo>=</mo><mi>a</mi><mo>*</mo><mi>U</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">h_1 = a * U + b</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>2</mn></msub><mo>=</mo><mi>a</mi><mo>*</mo><mn>3</mn><mo>*</mo><mi>U</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">h_2 = a * 3 * U + b</annotation></semantics></math> Then we get <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mn>2</mn></msub><mo>−</mo><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>*</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a = (h_2 - h_1) / (2 * U)</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>*</mo><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">b = (3 * h_1 - h_2) / 2</annotation></semantics></math> So for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">hleft_1</annotation></semantics></math> we get <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mi>a</mi><mo>*</mo><mn>0</mn><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">hleft_1 = a * 0 + b</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">= b</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>*</mo><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">= (3 * h_1 - h_2) / 2</annotation></semantics></math> However, note that <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">hleft_1</annotation></semantics></math> could become less than 0. This we should forbid, as it would imply a negative probability density.</p>
<p>So, taking this into account we get: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>*</mo><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">hleft_1 = max(0, (3 * h_1 - h_2) / 2)</annotation></semantics></math></p>
<p>For <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>S</mi></msub></mrow><annotation encoding="application/x-tex">hright_S</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#                 |hSm1</span></span>
<span><span class="co">#                 |               |</span></span>
<span><span class="co">#                 | h1            |               |hS</span></span>
<span><span class="co">#                 |               |               |              |hrightS</span></span>
<span><span class="co">#    _____________|_______________|_______________|______________|</span></span>
<span><span class="co">#                 pSm1            pS - U          pS             1</span></span>
<span><span class="co">#    segment S-1                  segment S</span></span></code></pre></div>
<p>The line through the coordinates <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>3</mn><mo>*</mo><mi>U</mi><mo>,</mo><msub><mi>h</mi><mrow><mi>S</mi><mi>m</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(1 - 3 * U, h_{Sm1})</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>U</mi><mo>,</mo><msub><mi>h</mi><mi>S</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(1 - U, h_S)</annotation></semantics></math> has the algebraic form <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">y = ax+b</annotation></semantics></math> So <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>S</mi><mi>m</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>a</mi><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>3</mn><mo>*</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">h_{Sm1} = a * (1 - 3 * U) + b</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>S</mi></msub><mo>=</mo><mi>a</mi><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">h_S   = a * (1 - U) + b</annotation></semantics></math> Then we get <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mi>S</mi></msub><mo>−</mo><msub><mi>h</mi><mrow><mi>S</mi><mi>m</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>*</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a = (h_S - h_{Sm1}) / (2 * U)</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><msub><mi>h</mi><mi>S</mi></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mrow><mi>S</mi><mi>m</mi><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>h</mi><mi>S</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>*</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b = h_S + (h_{Sm1} - h_S) * (1 - U) / (2 * U)</annotation></semantics></math></p>
<p>So for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>S</mi></msub></mrow><annotation encoding="application/x-tex">hright_S</annotation></semantics></math> we get <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>S</mi></msub><mo>=</mo><mi>a</mi><mo>*</mo><mn>1</mn><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">hright_S = a * 1 + b</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">= a + b</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mi>S</mi></msub><mo>−</mo><msub><mi>h</mi><mrow><mi>S</mi><mi>m</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>*</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>h</mi><mi>S</mi></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mrow><mi>S</mi><mi>m</mi><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>h</mi><mi>S</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>*</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">= (h_S - h_{Sm1}) / (2 * U) + h_S + (h_{Sm1} - h_S) * (1 - U) / (2 * U)</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>*</mo><msub><mi>h</mi><mi>S</mi></msub><mo>−</mo><msub><mi>h</mi><mrow><mi>S</mi><mi>m</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">= (3 * h_S - h_{Sm1}) / 2</annotation></semantics></math> This outcome is symmetric with <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>*</mo><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">hleft_1 = (3 * h_1 - h_2)/ 2</annotation></semantics></math></p>
<p>As with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">hleft_1</annotation></semantics></math> we should forbid negative values for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>S</mi></msub></mrow><annotation encoding="application/x-tex">hright_S</annotation></semantics></math>. So, taking this into account we get: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>S</mi></msub><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>*</mo><msub><mi>h</mi><mi>S</mi></msub><mo>−</mo><msub><mi>h</mi><mrow><mi>S</mi><mi>m</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">hright_S = max(0, (3 * h_S - h_{Sm1}) / 2)</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="representation-of-a-segment-from-an-ewgraph-as-a-geometric-figure">Representation of a segment from an ewgraph as a geometric figure<a class="anchor" aria-label="anchor" href="#representation-of-a-segment-from-an-ewgraph-as-a-geometric-figure"></a>
</h3>
<p>See the figure below. A segment of an ewgraph ABDEF can be considered to consist of two rectangular trapeziums, ABCF and EDCF, representing respectively the left and right halve of the segment. The corners ABC and CDE are rectangular.</p>
<p>The two trapeziums have a shared parallel line, CF, which has length hi. The three (one from the left trapezium, AB, one shared, CF, and one from the right trapezium, DE) parallel lines are perpendicular to the p-axis, BD. The lines of each trapezium BC and DC, that lie on the p-axis have each length U. Line AB has length <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>l</mi><mi>e</mi><mi>f</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">hleft_i</annotation></semantics></math>. Line ED has length <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">hright_i</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#                  F</span></span>
<span><span class="co">#                  "</span></span>
<span><span class="co">#                 / \</span></span>
<span><span class="co">#                / | \</span></span>
<span><span class="co">#               /  |  \</span></span>
<span><span class="co">#              /   |   \</span></span>
<span><span class="co">#             /    |    \</span></span>
<span><span class="co">#            /     |     \</span></span>
<span><span class="co">#           /      |      \</span></span>
<span><span class="co">#          /       |       \</span></span>
<span><span class="co">#         /        |        \</span></span>
<span><span class="co">#        /         |         \</span></span>
<span><span class="co">#       /          |          \</span></span>
<span><span class="co">#      /           |           \</span></span>
<span><span class="co">#     /            |            \</span></span>
<span><span class="co">#    /             |             \</span></span>
<span><span class="co">#   /              |              \</span></span>
<span><span class="co">#A |               |               \</span></span>
<span><span class="co">#  |               |                \ E</span></span>
<span><span class="co">#  |               |                |</span></span>
<span><span class="co">#  |               |                |</span></span>
<span><span class="co">#  |               |                |</span></span>
<span><span class="co">#  |_______________|________________|</span></span>
<span><span class="co">#  B               C                D</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  Figure: depiction of a segment from an ewgraph.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparison-with-standard-numerical-approximation-of-an-integral">Comparison with standard numerical approximation of an integral<a class="anchor" aria-label="anchor" href="#comparison-with-standard-numerical-approximation-of-an-integral"></a>
</h3>
<p>I cite from Wikipedia:</p>
<blockquote>
<p>In calculus, the definite integral of an arbitrary function f(x) can be numerically approximated as a discrete sum by partitioning the interval of integration into small uniform intervals and approximating the function’s value on each interval as the average of the values at its endpoints.</p>
</blockquote>
<p>We see here the correspondence between the small uniform intervals used for calculating the definite integral and the segments of the ewgraph.</p>
<p>In contrast to the cited method an ewgraph is in essence based on the middle value of a segment. The reason for this choice is that typically a probability graph in the realm we are dealing with, might have an infinite height at <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">p = 0</annotation></semantics></math> or at <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p = 1</annotation></semantics></math>. By steering clear from these values, we avoid this problem. Furthermore I think that using the one middle value of a segment as representative is more elegant and more symmetric than using the values of the end points as representative. But this is also a matter of taste.</p>
</div>
<div class="section level3">
<h3 id="representation-of-ewgraph-as-r-tibble">Representation of ewgraph as R tibble<a class="anchor" aria-label="anchor" href="#representation-of-ewgraph-as-r-tibble"></a>
</h3>
<p>In the programming language R we represent the ewgraph as a tibble with S rows. Each ith segment of the ewgraph has the following variables:</p>
<ul>
<li>
<code>p[[i]] = i/S - U</code>, this means that <code>p[[i]]</code> is the mid point of the ith segment</li>
<li>
<code>h[[i]] = c(p[[i]])</code> so <code>h[[i]]</code> is the chance of <code>p[[i]]</code>
</li>
<li>
<code>h_left[[i]]</code> which is a linear interpolation of <code>h[[i]]</code> and <code>h[[i-1]]</code> (but a linear extrapolation of <code>h[[1]]</code> and <code>h[[2]]</code> for <code>h_left[[1]]</code>)</li>
<li>
<code>h_right[[i]]</code> which is a linear interpolation of <code>h[[i]]</code> and <code>h[[i+1]]</code> (but a linear extrapolation of <code>h[[S]]</code> and <code>h[[S-1]]</code> for <code>h_right(S)</code>)</li>
<li>
<code>surface[[i]]</code> which is the surface of this ith segment.</li>
<li>
<code>cumsurface[[i]]</code> which is the cumulative of <code>surface[[i]]</code>, going from 1 to i</li>
</ul>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/cfjdoedens/ewgraph/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/cfjdoedens/ewgraph/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ewgraph</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Crist-Jan Doedens <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/cfjdoedens/ewgraph/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/cfjdoedens/ewgraph/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/cfjdoedens/ewgraph" class="external-link"><img src="https://codecov.io/gh/cfjdoedens/ewgraph/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Crist-Jan Doedens.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
